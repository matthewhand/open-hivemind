<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loading - Open Hivemind</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            overflow: hidden;
        }

        .loading-container {
            text-align: center;
            animation: fadeIn 0.8s ease-in-out;
            max-width: 900px;
            width: 90%;
        }

        .loading-spinner {
            width: 80px;
            height: 80px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 30px;
        }

        .loading-text {
            font-size: 2rem;
            font-weight: 300;
            margin-bottom: 10px;
            opacity: 0.9;
        }

        .loading-subtitle {
            font-size: 1rem;
            opacity: 0.7;
            margin-bottom: 40px;
        }

        .progress-bar {
            width: 300px;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            margin: 0 auto 40px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: white;
            border-radius: 2px;
            animation: progress 8s ease-in-out infinite;
        }

        /* Sitemap Preview Styles */
        .sitemap-preview {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 25px;
            margin-top: 30px;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            animation: slideIn 1s ease-out 2s both;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .sitemap-title {
            font-size: 1.3rem;
            margin-bottom: 20px;
            opacity: 0.95;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .sitemap-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 16px;
            max-height: 240px;
            overflow-y: auto;
            padding-right: 8px;
        }

        .sitemap-grid::-webkit-scrollbar {
            width: 6px;
        }

        .sitemap-grid::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }

        .sitemap-grid::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
        }

        .sitemap-category {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 15px;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
        }

        .sitemap-category:hover {
            transform: translateY(-3px);
            background: rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }

        .category-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 12px;
            color: #ffd700;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .category-pages {
            list-style: none;
        }

        .category-pages li {
            font-size: 0.85rem;
            opacity: 0.8;
            margin-bottom: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 4px 8px;
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.05);
        }

        .category-pages li:hover {
            opacity: 1;
            color: #ffd700;
            background: rgba(255, 215, 0, 0.2);
            transform: translateX(5px);
        }

        .loading-tip {
            font-size: 0.9rem;
            opacity: 0.7;
            margin-top: 25px;
            animation: pulse 2s ease-in-out infinite;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .stats-bar {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 15px;
            font-size: 0.8rem;
            opacity: 0.6;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes progress {
            0% { width: 0%; }
            25% { width: 30%; }
            50% { width: 60%; }
            75% { width: 85%; }
            100% { width: 100%; }
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }

        .particles {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: -1;
        }

        .particle {
            position: absolute;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }

        /* Mobile responsiveness */
        @media (max-width: 768px) {
            .sitemap-grid {
                grid-template-columns: 1fr;
                max-height: 180px;
            }
            
            .loading-text {
                font-size: 1.5rem;
            }
            
            .progress-bar {
                width: 250px;
            }

            .stats-bar {
                flex-direction: column;
                gap: 10px;
            }
        }

        /* Skip button */
        .skip-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            backdrop-filter: blur(10px);
        }

        .skip-button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="particles" id="particles"></div>
    
    <div class="loading-container">
        <div class="loading-spinner"></div>
        <h1 class="loading-text">Open Hivemind</h1>
        <p class="loading-subtitle">Multi-Agent AI Coordination Platform</p>
        <div class="progress-bar">
            <div class="progress-fill"></div>
        </div>
        
        <div class="sitemap-preview" id="sitemapPreview">
            <h3 class="sitemap-title">
                üó∫Ô∏è Explore Available Features
                <span id="loadingDots">...</span>
            </h3>
            <div class="sitemap-grid" id="sitemapGrid">
                <div class="sitemap-category">
                    <div class="category-title">üîÑ Discovering Features</div>
                    <ul class="category-pages">
                        <li>Loading system components...</li>
                        <li>Scanning available modules...</li>
                        <li>Preparing navigation...</li>
                    </ul>
                </div>
            </div>
            <div class="stats-bar" id="statsBar">
                <div class="stat-item">
                    <span>üìä</span>
                    <span id="pageCount">Loading...</span>
                </div>
                <div class="stat-item">
                    <span>üîÑ</span>
                    <span id="lastUpdated">Updating...</span>
                </div>
                <div class="stat-item">
                    <span>üöÄ</span>
                    <span>Ready in <span id="countdown">8</span>s</span>
                </div>
            </div>
            <p class="loading-tip">
                üí° Click any feature to navigate directly ‚Ä¢ 
                <span onclick="window.location.href='/dashboard/sitemap'" style="cursor: pointer; text-decoration: underline;">View Full Sitemap</span>
            </p>
        </div>
    </div>

    <button class="skip-button" onclick="window.location.href='/dashboard'">
        Skip to Dashboard ‚Üí
    </button>

    <script>
        let countdown = 8;
        let sitemapLoaded = false;

        // Create floating particles
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            const particleCount = 25;

            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                const size = Math.random() * 4 + 2;
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                particle.style.left = `${Math.random() * 100}%`;
                particle.style.top = `${Math.random() * 100}%`;
                particle.style.animationDelay = `${Math.random() * 6}s`;
                particle.style.animationDuration = `${6 + Math.random() * 4}s`;
                
                particlesContainer.appendChild(particle);
            }
        }

        // Animate loading dots
        function animateLoadingDots() {
            const dotsElement = document.getElementById('loadingDots');
            let dots = 0;
            
            setInterval(() => {
                dots = (dots + 1) % 4;
                dotsElement.textContent = '.'.repeat(dots);
            }, 500);
        }

        // Countdown timer
        function startCountdown() {
            const countdownElement = document.getElementById('countdown');
            
            const timer = setInterval(() => {
                countdown--;
                countdownElement.textContent = countdown;
                
                if (countdown <= 0) {
                    clearInterval(timer);
                    if (sitemapLoaded) {
                        window.location.href = '/dashboard';
                    }
                }
            }, 1000);
        }

        // Fetch and display dynamic sitemap
        async function loadSitemap() {
            try {
                const response = await fetch('/sitemap.json?access=public');
                if (!response.ok) throw new Error('Failed to fetch sitemap');
                
                const sitemapData = await response.json();
                displaySitemap(sitemapData.urls);
                updateStats(sitemapData);
                sitemapLoaded = true;
            } catch (error) {
                console.error('Error loading sitemap:', error);
                displayFallbackSitemap();
                sitemapLoaded = true;
            }
        }

        function categorizeUrls(urls) {
            const categories = {};
            
            urls.forEach(url => {
                let category = 'Other';
                let icon = 'üìÑ';
                
                if (url.url === '/' || url.url.includes('overview') || url.url.includes('dashboard')) {
                    category = 'Dashboard';
                    icon = 'üè†';
                } else if (url.url.includes('/bots')) {
                    category = 'Bot Management';
                    icon = 'ü§ñ';
                } else if (url.url.includes('/mcp')) {
                    category = 'MCP Servers';
                    icon = 'üîó';
                } else if (url.url.includes('/monitoring') || url.url.includes('/activity')) {
                    category = 'Monitoring';
                    icon = 'üìä';
                } else if (url.url.includes('/personas')) {
                    category = 'Personas';
                    icon = 'üé≠';
                } else if (url.url.includes('/settings')) {
                    category = 'Settings';
                    icon = '‚öôÔ∏è';
                } else if (url.url.includes('/export') || url.url.includes('/static') || url.url.includes('/sitemap')) {
                    category = 'Tools & Resources';
                    icon = 'üìÅ';
                }
                
                if (!categories[category]) {
                    categories[category] = { icon, urls: [] };
                }
                
                categories[category].urls.push(url);
            });
            
            return categories;
        }

        function displaySitemap(urls) {
            const sitemapGrid = document.getElementById('sitemapGrid');
            const filteredUrls = urls.filter(url => 
                !url.url.includes('/health') && 
                !url.url.includes('/api') && 
                !url.url.includes('/login') &&
                !url.url.includes('/webui') &&
                !url.url.includes('/admin') &&
                url.access === 'public'
            );
            
            const categories = categorizeUrls(filteredUrls);
            sitemapGrid.innerHTML = '';
            
            Object.entries(categories).forEach(([categoryName, categoryData]) => {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'sitemap-category';
                
                const titleDiv = document.createElement('div');
                titleDiv.className = 'category-title';
                titleDiv.innerHTML = `${categoryData.icon} ${categoryName}`;
                
                const pagesList = document.createElement('ul');
                pagesList.className = 'category-pages';
                
                categoryData.urls.slice(0, 4).forEach(url => {
                    const li = document.createElement('li');
                    li.textContent = url.description.replace(/^.*? - /, '').replace('System ', '').replace('Management', 'Manager');
                    li.onclick = (e) => {
                        e.stopPropagation();
                        window.location.href = url.url;
                    };
                    pagesList.appendChild(li);
                });
                
                if (categoryData.urls.length > 4) {
                    const moreLi = document.createElement('li');
                    moreLi.textContent = `+${categoryData.urls.length - 4} more features...`;
                    moreLi.style.fontStyle = 'italic';
                    moreLi.style.opacity = '0.6';
                    moreLi.onclick = (e) => {
                        e.stopPropagation();
                        window.location.href = '/dashboard/sitemap';
                    };
                    pagesList.appendChild(moreLi);
                }
                
                categoryDiv.appendChild(titleDiv);
                categoryDiv.appendChild(pagesList);
                
                // Make entire category clickable to first URL
                categoryDiv.onclick = () => {
                    if (categoryData.urls.length > 0) {
                        window.location.href = categoryData.urls[0].url;
                    }
                };
                
                sitemapGrid.appendChild(categoryDiv);
            });
        }

        function updateStats(sitemapData) {
            document.getElementById('pageCount').textContent = `${sitemapData.totalUrls} total pages`;
            document.getElementById('lastUpdated').textContent = new Date(sitemapData.generated).toLocaleTimeString();
        }

        function displayFallbackSitemap() {
            const sitemapGrid = document.getElementById('sitemapGrid');
            sitemapGrid.innerHTML = `
                <div class="sitemap-category" onclick="window.location.href='/dashboard'">
                    <div class="category-title">üè† Dashboard</div>
                    <ul class="category-pages">
                        <li onclick="event.stopPropagation(); window.location.href='/dashboard'">System Overview</li>
                        <li onclick="event.stopPropagation(); window.location.href='/monitor'">System Monitoring</li>
                        <li onclick="event.stopPropagation(); window.location.href='/dashboard/activity'">Activity Monitor</li>
                    </ul>
                </div>
                <div class="sitemap-category" onclick="window.location.href='/dashboard/bots'">
                    <div class="category-title">ü§ñ Bot Management</div>
                    <ul class="category-pages">
                        <li onclick="event.stopPropagation(); window.location.href='/dashboard/bots'">Manage Bots</li>
                        <li onclick="event.stopPropagation(); window.location.href='/dashboard/bots/create'">Create Bot</li>
                        <li onclick="event.stopPropagation(); window.location.href='/dashboard/personas'">Bot Personas</li>
                    </ul>
                </div>
                <div class="sitemap-category" onclick="window.location.href='/dashboard/settings'">
                    <div class="category-title">‚öôÔ∏è Configuration</div>
                    <ul class="category-pages">
                        <li onclick="event.stopPropagation(); window.location.href='/dashboard/settings'">System Settings</li>
                        <li onclick="event.stopPropagation(); window.location.href='/dashboard/export'">Export Data</li>
                        <li onclick="event.stopPropagation(); window.location.href='/dashboard/sitemap'">Full Sitemap</li>
                    </ul>
                </div>
            `;
            
            document.getElementById('pageCount').textContent = '15+ pages available';
            document.getElementById('lastUpdated').textContent = 'Just now';
        }

        // Auto-redirect after loading
        function autoRedirect() {
            setTimeout(() => {
                if (sitemapLoaded) {
                    window.location.href = '/dashboard';
                }
            }, 8000);
        }

        // Initialize
        createParticles();
        animateLoadingDots();
        startCountdown();
        loadSitemap();
        autoRedirect();

        // Handle keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
                window.location.href = '/dashboard';
            } else if (e.key === 'Escape') {
                window.location.href = '/dashboard/sitemap';
            }
        });
    </script>
</body>
</html>